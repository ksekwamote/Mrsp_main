<html class="no-js" lang="en">

<head>
    <title>Landlord | Tenant</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/r/dt/jq-2.1.4,jszip-2.5.0,pdfmake-0.1.18,dt-1.10.9,af-2.0.0,b-1.0.3,b-colvis-1.0.3,b-html5-1.0.3,b-print-1.0.3,se-1.0.1/datatables.min.css"/>

    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/table.css">
    <link rel="stylesheet" href="/css/buttons.css">
</head>


<body>


    <div class="container-fluid">
        <div class="row">
          <nav class="col-lg-2 col-12 d-lg-block d-none px-0">
              <div class="sidebar">
                  <div class=" pl-3 pt-2">
                    <h3 class="text-primary text-truncate m-0  mt-0">MrsP </h3>
                    <small class="m-0 text-light">Landlord Admin</small>
                  </div>

                  <p class="text-muted text-uppercase mb-1 mt-4 px-3">Menu</p>

                  <ul class="nav flex-column">
                      <li class="nav-item">
                          <a class="nav-link " href="/listings/create">
                              <i class="fas fa-plus"></i>
                              Add New Property
                          </a>
                      </li>
                      <li class="nav-item ">
                          <a class="nav-link" href="/listings">
                              <i class="fas fa-tasks"></i>
                              Properties
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/applications">
                              <i class="fas fa-tasks"></i>
                              Screenings
                          </a>

                      </li>
                      <li class="nav-item">
                          <a class="nav-link active" href="/tenants">
                              <i class="fas fa-tasks"></i>
                              Tenants
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/tenants/transactions">
                              <i class="fas fa-tasks"></i>
                              Payments
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/listings/expenses">
                              <i class="fas fa-tasks"></i>
                              Expenses
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/listings/expenses">
                              <i class="fas fa-tasks"></i>
                              Expenses
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/tenants/escalations">
                              <i class="fas fa-tasks"></i>
                              Escalations
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/tenants/defaulters">
                              <i class="fas fa-tasks"></i>
                              Defaulters
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/tenants/lapsing">
                              <i class="fas fa-tasks"></i>
                              Lapsing
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="/tenants/service_requests">
                              <i class="fas fa-tasks"></i>
                              Service Requests
                          </a>
                      </li>
                  </ul>
              </div>
          </nav>
            <div class="col-lg-10 col-12 px-0">
                <?- include('./partials/header') -?>

                <div class="container">

                    <div class="container  my-3">
                        <h3> <span class="text-secondary"><?=payload.tenant.profile.name?></span></h3>
                        <p class="m-0 text-secondary">Active tenant's billing and maintenance information</p>
                        <!--
                         <div class="btn-group pt-1">
                              <button type="button" class="btn btn-outline-secondary btn-sm rounded" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                Lease Options
                                <i class="fas fa-chevron-down"></i>
                              </button>
                              <div class="dropdown-menu dropdown-menu-right">
                                <button class="dropdown-item btn btn-sm" type="button">Extend Lease</button>
                                <button class="dropdown-item btn btn-sm" type="button">Terminate Lease Lease</button>
                              </div>
                            </div>
                          -->
                    </div>



                    <div class="container">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#one">Billing(<?=payload.payments.length?>)</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#two">Maintenance(<?=payload.service_requests.length?>)</a>
                            </li>
                        </ul>
                    </div>
                    <div class="container">
                        <div class="row">
                            <div class="col-12 col-lg-9 mt-3">
                                <div class="tab-content">
                                    <div class="col-lg-12 card-main tab-pane active bg-white pb-3 border shadow-sm" id="one">
                                        <div class="container px-0">
                                            <div class="row bg-dark p-0">
                                                <div class="col-6 align-self-center">
                                                    <h5 class="bg-dark text-light pt-2"><b>Billing</b></h5>
                                                </div>

                                            </div>
                                            <!--TABLE-->
                                            <div class="pt-3">
                                                <table class="table table-striped mytable"
                                                    style="width:100%;font-size: 14px;">
                                                    <thead>
                                                        <tr>
                                                            <th>No.</th>
                                                            <th>Description</th>
                                                            <th>Amount</th>
                                                            <th>Due Date</th>
                                                            <th>Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="payments_table">
                                                        <? payload.payments.forEach((payment, index) => { ?>
                                                        <tr>
                                                            <td><?=index?></td>
                                                            <td><?=payment.description?></td>
                                                            <td><?=payment.amount?></td>
                                                            <td><?=payment.due_date?></td>
                                                            <td><?=payment.status?></td>
                                                        </tr>
                                                        <? }); ?>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-12 card-main tab-pane fade bg-white pb-3 border shadow-sm" id="two">
                                        <div class="container px-0">
                                            <div class="row bg-dark p-0">
                                                <div class="col-6 align-self-center">
                                                    <h5 class="bg-dark text-light pt-2"><b>Maintenance</b></h5>
                                                </div>
                                                <div class="col-6 text-right">
                                                    <a href="#" name="button" data-toggle="modal"
                                                        data-target="#noticeboard_modal"
                                                        class="btn btn-secondary btn-sm rounded my-2">
                                                        <i class="fas fa-exclamation-circle"></i>
                                                        Post to noticeboard
                                                    </a>
                                                </div>
                                            </div>

                                            <div class="pt-3">
                                                    <table  class="table table-striped mytable2"
                                                        style="width:100%;font-size: 14px;">
                                                        <thead>

                                                                <th>No.</th>
                                                                <th>Title</th>
                                                                <th>Date Reported</th>
                                                                <th>Status</th>
                                                                <th></th>

                                                        </thead>

                                                        <tbody>
                                                             <? payload.service_requests.forEach((request, index) => { ?>
                                                                <tr>
                                                                    <td><?=index?></td>
                                                                    <td><?=request.title?></td>
                                                                    <td><?=request.date_reported?></td>
                                                                    <td><?= parseInt(request.status) === 0 ? 'Open' : 'Pending Confirmation'?></td>
                                                                    <td>
                                                                        <a href="#" data-toggle="modal"
                                                                        data-target="#service_request_modal"
                                                                        id="create_rental_preset_button"
                                                                        data-service_request="<?=JSON.stringify(request)?>">
                                                                        View
                                                                    </a>
                                                                    </td>
                                                                </tr>
                                                            <? }); ?>
                                                        </tbody>
                                                    </table>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="tenant-info"
                                class=" container col-10 col-md-5 col-lg-3 border-0 bg-custom-dark mt-lg-n5 mt-md-3 mt-3 text-lg-left text-md-left">
                                <div class=" p-0">
                                    <div class="row bg-dark p-2 pl-3 text-light mb-3">
                                        <h5><b>Tenant information</b></h5>
                                    </div>
                                    
                                    <div class="my-2">
                                        <small class="text-muted"><b>Name</b></small>
                                        <p class="text-light"><?= payload.tenant.profile.first_name?> <?= payload.tenant.profile.last_name?> </p>
                                    </div>
                                    <div>
                                        <small class="text-muted"><b>Mobile</b></small>
                                        <p class="text-light"><?= payload.tenant.profile.phone_number?> </p>
                                    </div>
                                    <div>
                                        <small class="text-muted"><b>Email Address</b></small>
                                        <p class="text-light" id="email_address"><?= payload.tenant.profile.email_address?> </p>
                                    </div>
                                    <!-- <hr class="mb-2 bg-primary"> -->
                                    <div>
                                        <small class="text-muted"><b>Tenancy</b></small>
                                        <p class="text-light"><?= payload.tenant.tenancy_period?> months</p>
                                    </div>
                                    <div>
                                        <small class="text-muted"><b>Rental presets</b></small>
                                        <p class="text-primary"> <?= payload.rental_preset.name?> </p>
                                    </div>
                                    <div class="mb-3">
                                        <p>
                                            <a href="/listings/view_listing?id=<?=payload.listing.ID?>"
                                                class="btn btn-outline-secondary btn-sm btn-block">
                                                Go To Listing <i class="fas fa-external-link-square-alt"></i>
                                            </a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="modal fade" id="service_request_modal" tabindex="-1" role="dialog"
                        aria-labelledby="service_request_modalTitle" aria-hidden="true">
                        <div class="modal-dialog modal-md modal-dialog-centered" role="document">
                            <div class="modal-content rounded-0 border-0">
                                <div class="modal-header pb-2 bg-dark rounded-0">
                                    <h5 class="modal-title text-light" id="service_request_modalTitle">Service Request
                                    </h5>
                                    <button type="button" class="close text-light border-0" data-dismiss="modal"
                                        aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body pb-0 px-0">
                                    <div class="row">
                                        <div class="container px-5">
                                            <div class="row">
                                                <div class="col-lg-6">
                                                    <p id="status" class="text-uppercase"></p>
                                                </div>

                                                <div class="col-lg-6">
                                                    <p id="date"></p>
                                                </div>
                                            </div>

                                            <h4 class="m-0 mb-2 text-secondary" id="title"></h4>

                                            <p id="urgency"  class="mb-2"></p>

                                            <p id="date_available"  class="mb-2"></p>

                                            <p id="authorized_rep_name"  class="mb-2"></p>

                                            <p id="authorized_rep_number" class="mb-3"></p>

                                            <p id="description" class="p-3 border bg-light mt-2"></p>

                                        </div>
                                        <div class="container">
                                            <input type="hidden" id="tenant_id" name="tenant_id" value="<?=payload.tenant.ID?>">
                                            <button id="resolve_button"
                                                class="btn btn-md btn-secondary btn-block rounded-0"><i
                                                class="fas fa-check"></i> Mark as
                                                Resolved</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="noticeboard_modal" tabindex="-1" role="dialog"
                        aria-labelledby="noticeboard_modalTitle" aria-hidden="true">
                        <div class="modal-dialog modal-md modal-dialog-centered" role="document">
                            <div class="modal-content rounded-0 border-0">
                                <div class="modal-header pb-2 bg-dark rounded-0">
                                    <h5 class="modal-title text-light" id="noticeboard_modalTitle">Post to Noticeboard
                                    </h5>
                                    <button type="button" class="close text-light border-0" data-dismiss="modal"
                                        aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body pb-0 px-0">
                                    <div class="row">
                                        <div class="container px-5">
                                            <p class="radio-inline" for="charge_late_fee-0">
                                                <input type="radio" name="all" id="all" checked="checked"> Send to all
                                            </p>

                                            <p class="radio-inline" for="charge_late_fee-0">
                                                <input type="radio" name="all" id="single" value="true"> Send to this
                                                tenant
                                                only
                                            </p>

                                            <textarea id="message" name="message" rows="8" cols="80"
                                                class="form-control my-3" placeholder="Message goes here..."></textarea>
                                        </div>
                                        <div class="container">
                                            <button type="button" name="button" id="post_button"
                                                onclick="post_to_noticeboard(<?=payload.listing.ID?>, <?=payload.tenant.ID?>);"
                                                class="btn btn-md btn-secondary btn-block rounded-0">Post</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="create_payment_modal" tabindex="-1" role="dialog"
                        aria-labelledby="create_payment_modalTitle" aria-hidden="true">
                        <div class="modal-dialog modal-md modal-dialog-centered" role="document">
                            <div class="modal-content rounded-0 border-0">
                                <div class="modal-header pb-2 bg-dark rounded-0">
                                    <h5 class="modal-title text-light" id="create_payment_modalTitle">Invoice Tenant
                                    </h5>
                                    <button type="button" class="close text-light border-0" data-dismiss="modal"
                                        aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body pb-0 px-0">
                                    <div class="row">
                                        <div class="container px-5">
                                            <div class="form-row mb-4">
                                                <small class="text-muted">Payment Description</small>
                                                <input id="payment_description" class="form-control" type="text"
                                                    name="description" placeholder="Description">
                                            </div>
                                            <div class="form-row mb-4">
                                                <div class="col">
                                                    <small class="text-muted">Amount</small>
                                                    <input id="payment_amount" class="form-control" type="number"
                                                        name="amount" placeholder="Amount" step="0.01">

                                                </div>
                                                <div class="col">
                                                    <small class="text-muted">Due Date</small>
                                                    <input id="payment_due_date" class="form-control" type="date"
                                                        name="due_date">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="container">
                                            <button id="resolve_button" type="button"
                                                class="btn btn-md btn-secondary btn-block rounded-0"
                                                onclick="create_payment(<?=payload.tenant.ID?>);">
                                                Send Invoice
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <footer class="pt-5">
                        <div class="container">
                            <div class="row">
                                <div class="col-12 text-center">
                                    <hr>
                                    <p class="text-muted">Mrs.P &copy Copyright 2021</p>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
        <script>
        $(document).ready(function () {
                $('.mytable').DataTable({
                  pageLength: 10,
                  filter: true,
                  deferRender: true,
                  scrollY: 200,
                  scrollCollapse: true,
                  scroller: true,
                  dom: 'lBfrtip',
                  buttons: [{
                            extend: 'excelHtml5',
                            text: 'Export to Excel',
                            title: 'billing-export',
                            download: 'open',
                            orientation:'landscape',
                            exportOptions: {
                              columns: ':visible'
                            }
                          }]
                }),

                $('.mytable2').DataTable({
                  pageLength: 10,
                  filter: true,
                  deferRender: true,
                  scrollY: 200,
                  scrollCollapse: true,
                  scroller: true,
                  dom: 'lBfrtip',
                  buttons: [{
                            extend: 'excelHtml5',
                            text: 'Export to Excel',
                            title: 'maintenance-export',
                            download: 'open',
                            orientation:'landscape',
                            exportOptions: {
                              columns: ':visible'
                            }
                          }]
                });
            });
          </script>

        <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/r/dt/jq-2.1.4,jszip-2.5.0,pdfmake-0.1.18,dt-1.10.9,af-2.0.0,b-1.0.3,b-colvis-1.0.3,b-html5-1.0.3,b-print-1.0.3,se-1.0.1/datatables.min.js"></script>
        <script src="/javascripts/service_requests.js" charset="utf-8"></script>
        <script src="/javascripts/tenant_view.js" charset="utf-8"></script>
</body>

</html>

<html class="no-js" lang="en">
  <head>
    <title>Landlord | Tenants</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://code.jquery.com/jquery-3.3.1.js"
      integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/datetime/1.1.1/css/dataTables.dateTime.min.css"
    />

    <link rel="stylesheet" href="/css/bootstrap.css" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/table.css" />
    <link rel="stylesheet" href="/css/breadcrumbs.css" />
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <nav class="col-lg-2 col-12 d-lg-block d-none px-0">
          <div class="sidebar">
            <div class="pl-3 pt-2">
              <h3 class="text-primary text-truncate m-0 mt-0">MrsP</h3>
              <small class="m-0 text-light">Landlord Admin</small>
            </div>

            <p class="text-muted text-uppercase mb-1 mt-4 px-3">Menu</p>

            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link" href="/listings/create">
                  <i class="fas fa-plus"></i>
                  Add New Property
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/listings">
                  <i class="fas fa-tasks"></i>
                  Properties
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/applications">
                  <i class="fas fa-tasks"></i>
                  Screenings
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/tenants">
                  <i class="fas fa-tasks"></i>
                  Tenants
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/tenants/transactions">
                  <i class="fas fa-tasks"></i>
                  Payments
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/listings/expenses">
                  <i class="fas fa-tasks"></i>
                  Expenses
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/tenants/escalations">
                  <i class="fas fa-tasks"></i>
                  Escalations
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/tenants/defaulters">
                  <i class="fas fa-tasks"></i>
                  Defaulters
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/tenants/lapsing">
                  <i class="fas fa-tasks"></i>
                  Lapsing
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" href="/tenants/service_requests">
                  <i class="fas fa-tasks"></i>
                  Service Requests
                </a>
              </li>
              <!-- <li class="nav-item">
                <a class="nav-link" href="/tenants/tenant_bills">
                  <i class="fas fa-tasks"></i>
                  Tenant Bills
                </a>
              </li> -->
            </ul>
          </div>
        </nav>
        <div class="col-lg-10 col-12 px-0">
          <?- include('./partials/header') -?>
          <div class="my-container">
            <div class="container">
              <div class="container my-3">
                <div class="page__section">
                  <ul class="breadcrumbs breadcrumbs_type5">
                    <li class="breadcrumbs__item">
                      <i class="fas fa-home"></i>
                      <a href="#0" class="breadcrumbs__element">Home</a>
                    </li>
                    <li class="breadcrumbs__item breadcrumbs__item_active">
                      <span class="breadcrumbs__element">Service Requests</span>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="pt-3">
                <table cellspacing="5" cellpadding="5" border="0">
                  <tbody>
                    <tr>
                      <td>From Date</td>
                      <td><input type="text" id="min" name="min" /></td>
                    </tr>
                    <tr>
                      <td>To Date:</td>
                      <td><input type="text" id="max" name="max" /></td>
                    </tr>
                  </tbody>
                </table>
                <table id="service_request_table" class="table table-striped">
                  <thead>
                    <th>No.</th>
                    <th>Listing</th>
                    <th>Tenant</th>
                    <th>Title</th>
                    <th>Reported</th>
                    <th>Assigned</th>
                    <th>Resolved</th>
                    <th>Labour Cost</th>
                    <th>Supply Cost</th>
                    <th>VAT</th>
                    <th>Total Cost</th>
                    <th>Status</th>
                    <th></th>
                  </thead>
                  <tbody>
                    <? payload.service_requests.forEach((request, index) =>
                    { ?>
                    <tr>
                      <td><?=request.ID?></td>
                      <td>
                        <a
                          target="_blank"
                          href="/listings/view_listing?id=<?=request.listing_id?>"
                        >
                          <?=request.plot?>,
                          <?=request.location?>
                        </a>
                      </td>
                      <td>
                        <a
                          href="/tenants/view_tenant?id=<?=request.ActiveTenantID?>"
                        >
                          <?=request.fullname?>
                        </a>
                      </td>
                      <td><?=request.title?></td>
                      <td><?=request.date_reported?></td>
                      <td><?=request.date_assigned?></td>
                      <td><?=request.date_resolved?></td>
                      <td><?=request.labour_cost?></td>
                      <td><?=request.supply_cost?></td>
                      <td><?=request.vat?></td>
                      <td><?=request.total_cost?></td>
                      <td><?=request.status?></td>

                      <td>
                        <a
                          href="#"
                          data-toggle="modal"
                          data-target="#service_request_modal"
                          id="create_rental_preset_button"
                          data-service_request="<?=JSON.stringify(request)?>"
                        >
                          View
                        </a>
                      </td>
                    </tr>
                    <? }); ?>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="service_request_modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="service_request_modalTitle"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-md modal-dialog-centered" role="document">
        <div class="modal-content rounded-0 border-0">
          <div class="modal-header pb-2 bg-dark rounded-0">
            <h5 class="modal-title text-light" id="service_request_modalTitle">
              Service Request
            </h5>
            <button
              type="button"
              class="close text-light border-0"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body pb-0 px-0">
            <div class="row">
              <div class="container px-5">
                <p id="status" class="text-uppercase"></p>

                <h4 class="m-0 mb-2 text-secondary" id="title"></h4>
                <p id="description" class="p-3 border bg-light mt-2"></p>

                <p id="urgency" class="mb-2"></p>
                <p id="date"></p>

                <p id="authorized_rep_name" class="mb-2"></p>

                <p id="authorized_rep_number" class="mb-3"></p>
                <p id="date_available" class="mb-2"></p>
                <hr />
                <p id="assigned_respondent" class="mb-3"></p>
                <p id="respondent_contact" class="mb-3"></p>
                <p id="date_assigned" class="mb-3"></p>

                <hr />

                <small>Respondent contact info will be sent to Tenant</small>
                <div class="row">
                  <div class="col-4">
                    <input
                      id="assigned_respondent_a"
                      class="form-control"
                      type="text"
                      name="assigned_respondent_a"
                      placeholder="Name"
                    />
                  </div>
                  <div class="col-4">
                    <input
                      id="respondent_contact_a"
                      class="form-control"
                      type="number"
                      name="respondent_contact_a"
                      placeholder="Contact"
                    />
                  </div>
                  <div class="col-4">
                    <button
                      id="assign_btn"
                      type="button"
                      class="btn btn-block btn-primary rounded-0"
                      name="button"
                    >
                      Assign
                    </button>
                  </div>
                </div>
                <hr />

                <small>Log the expenses associated with this request.</small>
                <div class="row">
                  <div class="col-4">
                    <input
                      id="labour_cost"
                      placeholder="Labour"
                      type="number"
                      name="Labour Cost"
                      step="0.01"
                      min="0"
                      class="form-control"
                    />
                  </div>
                  <div class="col-4">
                    <input
                      id="supply_cost"
                      placeholder="Supply"
                      type="number"
                      name="Supply Cost"
                      name="Supply Cost"
                      step="0.01"
                      min="0"
                      class="form-control"
                    />
                  </div>
                  <div class="col-4">
                    <input
                      id="vat"
                      placeholder="VAT"
                      type="number"
                      name="VAT"
                      value=""
                      step="0.01"
                      min="0"
                      class="form-control"
                    />
                  </div>
                </div>
                <hr />
              </div>
              <div class="container">
                <button
                  id="resolve_button"
                  class="btn btn-md btn-secondary btn-block rounded-0"
                >
                  <i class="fas fa-check"></i> Mark as Resolved
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/r/dt/jq-2.1.4,jszip-2.5.0,pdfmake-0.1.18,dt-1.10.9,af-2.0.0,b-1.0.3,b-colvis-1.0.3,b-html5-1.0.3,b-print-1.0.3,se-1.0.1/datatables.min.js"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="https://cdn.datatables.net/datetime/1.1.1/js/dataTables.dateTime.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>

    <script>
      $(document).ready(function () {
        var minDate, maxDate;
        $.fn.dataTable.ext.search.push(function (settings, data, dataIndex) {
          var min = minDate.val();
          var max = maxDate.val();
          var date = new Date(data[3]);

          if (
            (min === null && max === null) ||
            (min === null && date <= max) ||
            (min <= date && max === null) ||
            (min <= date && date <= max)
          ) {
            return true;
          }
          return false;
        });

        // Create date inputs
        minDate = new DateTime($("#min"), {
          format: "YYYY-MM-DD",
        });

        maxDate = new DateTime($("#max"), {
          format: "YYYY-MM-DD",
        });
        $("#service_request_table").DataTable({
          pageLength: 10,
          filter: true,
          deferRender: true,
          scrollY: 200,
          scrollCollapse: true,
          scroller: true,
          dom: "lBfrtip",
          buttons: [
            {
              extend: "excelHtml5",
              text: "Export to Excel",
              title: "maintenance-export",
              download: "open",
              orientation: "landscape",
              exportOptions: {
                columns: ":visible",
              },
            },
          ],
        });
        $("#min, #max").on("change", function () {
          $("#service_request_table").DataTable().draw();
        });
      });
    </script>

    <script src="/javascripts/service_requests.js" charset="utf-8"></script>
  </body>
</html>
